<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/security
	http://www.springframework.org/schema/security/spring-security.xsd">
		
	<!-- This is for security purposes -->
       
 <beans:bean class="org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler"/>
 <beans:bean id="webSecurityExpressionHandler" class="org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler" />  
   <http  use-expressions="true">
     
   <intercept-url pattern="/index*" access="permitAll" />
   <access-denied-handler ref="my403" />
	
	<intercept-url pattern="/dashboard*" access="hasAnyRole('ADMIN')" />
	<intercept-url pattern="/maintenance*" access="hasAnyRole('ADMIN')" />
	<intercept-url pattern="/sunday_service*" access="hasAnyRole('ADMIN')" />
	<intercept-url pattern="/attendees*" access="hasAnyRole('ADMIN')" />
	<intercept-url pattern="/reports*" access="hasAnyRole('ADMIN')" />
	
		
		<form-login 
		    login-page="/index.html"  username-parameter="username"
			password-parameter="password"
			default-target-url="/process_user.html" 
			authentication-failure-url="/index.html?error"
			 authentication-success-handler-ref="myAuthenticationSuccessHandler"
			 authentication-details-source-ref="webSecurityExpressionHandler"/>
			 
		<logout logout-success-url="/index.html?logout"  />
		
		<logout delete-cookies="JSESSIONID" />
   	    <remember-me key="uniqueAndSecret" token-validity-seconds="86400" />
   	    
   	    
   	    <custom-filter position="CONCURRENT_SESSION_FILTER" ref="concurrencyFilter" />
	    <custom-filter after="FORM_LOGIN_FILTER" ref="myAuthFilter"  />
	
	    <session-management session-authentication-strategy-ref="sas"/>
	</http>
	
	 <beans:bean id="my403"
		class="com.am.controller.MyAccessDeniedHandler">
		<beans:property name="errorPage" value="403.html" />
	</beans:bean> 
	  
	 <beans:bean id="myAuthenticationSuccessHandler"
        class="com.am.controller.MySimpleUrlAuthenticationSuccessHandler" />
 
	<authentication-manager alias="authenticationManager" >
			<authentication-provider>
			 <jdbc-user-service data-source-ref="dataSource"
				  users-by-username-query=	
				    "select username, password, enabled from asystem.users where username = ?"
				  authorities-by-username-query=
				    "select username, role from asystem.user_roles where username = ?"/>
		</authentication-provider>
	</authentication-manager>


	  <beans:bean id="concurrencyFilter"
	      class="org.springframework.security.web.session.ConcurrentSessionFilter">
	    <beans:property name="sessionRegistry" ref="sessionRegistry" />
	    <beans:property name="expiredUrl" value="/login_expired.html" />
	  </beans:bean>
	
	  <beans:bean id="myAuthFilter"
	      class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
	    <beans:property name="sessionAuthenticationStrategy" ref="sas" />
	    <beans:property name="authenticationManager" ref="authenticationManager" />
	    
	    
	  </beans:bean>
	
	  <beans:bean id="sas"
	      class="org.springframework.security.web.authentication.session.ConcurrentSessionControlStrategy">
	    <beans:constructor-arg name="sessionRegistry" ref="sessionRegistry" />
	    <beans:property name="maximumSessions" value="1" />
	  </beans:bean>
	
	  <beans:bean id="sessionRegistry" class="org.springframework.security.core.session.SessionRegistryImpl" />
	

</beans:beans>
